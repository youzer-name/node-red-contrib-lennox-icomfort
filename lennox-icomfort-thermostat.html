
<script type="text/x-red" data-template-name="lennox-icomfort-thermostat">
  <div class="form-row">
      <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
      <input type="text" id="node-input-name">
  </div>
  <div class="form-row">
      <label for="node-input-config"><i class="fa fa-cog"></i> Credentials</label>
      <input type="hidden" id="node-input-config">
  </div>
  <div class="form-row">
      <label for="node-input-polling"><i class="fa fa-clock-o"></i> Polling Interval (sec, 0=off)</label>
      <input type="number" id="node-input-polling" min="0">
  </div>
  <div class="form-row">
      <label for="node-input-createGlobal"><i class="fa fa-globe"></i> Create global variable</label>
      <input type="checkbox" id="node-input-createGlobal" style="width:auto;">
  </div>
</script>

<script type="text/x-red" data-help-name="lennox-icomfort-thermostat">
<p>Polls the Lennox iComfort thermostat at a configurable interval and outputs status. All commands can be sent to this node via input messages, either from a command node or directly.</p>
<p><b>Supported incoming message parameters:</b></p>
<ul>
    <li><code>command</code>: The command to execute. Supported values: <code>refresh</code>, <code>systemInfo</code>, <code>setSetpoints</code>, <code>setThermostatMode</code>, <code>setFanMode</code>, <code>away</code>, <code>home</code>, <code>heatLevelUp</code>, <code>heatLevelDown</code>, <code>coolLevelUp</code>, <code>coolLevelDown</code>. <b>Note: The <code>present</code> command is not user-facing.</b></li>
    <li><code>heatingSetpoint</code>: (number) Required for <code>setSetpoints</code>. The desired heating setpoint.</li>
    <li><code>coolingSetpoint</code>: (number) Required for <code>setSetpoints</code>. The desired cooling setpoint.</li>
    <li><code>mode</code>: (string) For <code>setThermostatMode</code>. One of: <code>off</code>, <code>heat</code>, <code>cool</code>, <code>auto</code>, <code>emergency heat</code>.</li>
    <li><code>thermostatmode</code>: (string) Alternative to <code>mode</code> for <code>setThermostatMode</code>.</li>
    <li><code>fanmode</code>: (string) For <code>setFanMode</code>. One of: <code>auto</code>, <code>on</code>, <code>circulate</code>.</li>
    <li><code>params</code>: (object) Optional. Additional parameters to merge into the command.</li>
</ul>
<p>For <code>setSetpoints</code>, both <code>heatingSetpoint</code> and <code>coolingSetpoint</code> must be provided. The cooling setpoint must be at least 3°F higher than the heating setpoint (deadband enforcement). For level up/down commands, no parameters are needed. The node will automatically adjust the other setpoint if needed to maintain the 3°F deadband.</p>
</script>

<script type="text/javascript">
RED.nodes.registerType('lennox-icomfort-thermostat', {
    category: 'function',
    color: '#AAAA66',
    defaults: {
        name: { value: '' },
        config: { type: 'lennox-icomfort-config', required: true },
        polling: { value: 0, required: false },
        createGlobal: { value: false }
    },
    inputs: 1,
    outputs: 1,
    icon: 'font-awesome/fa-thermometer-half',
    label: function () { return this.name || 'Lennox iComfort Thermostat'; },
    oneditprepare: function () {
        $('#node-input-polling').val(this.polling);
        $('#node-input-createGlobal').prop('checked', this.createGlobal);
    },
    oneditsave: function () {
        this.polling = $('#node-input-polling').val();
        this.createGlobal = $('#node-input-createGlobal').prop('checked');
    }
});
</script>
